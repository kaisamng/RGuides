# Census Data and Linear Regression 

## Install packages and Census API Key

Start by loading the required libraries.

```{r echo=TRUE, results=FALSE}

library("tidycensus")
library("tidyverse")
library("reshape")
```

Install your Census API Key into R with this call.

```{r eval=FALSE, }
census_api_key("<Census Key Goes Here>", install=TRUE, overwrite=TRUE)
```

## Pull data from the Census

Pull variable data into dataframe. 

* Notice the "geography" is "zcta," which is the Census Bureau's equivalent of a ZIP Code. 

* state="VA" variable helps limit the scope of our data to just VA, otherwise it will download all US.

```{r}
income_with_children <- get_acs(geography="zcta",
                  state="VA",
                  variables=c("B19125_002"),
                  year=2019)

head(income_with_children)

income_no_children<- get_acs(geography="zcta",
                            state="VA",
                            variables=c("B19125_003"),
                            year=2019)
head(income_no_children)
```


## Construct a Linear Model

Every scatterplot consists of a **Explanatory Variable**, and a **Response Variable**. In this example, I set the Explanatory Variable as as a separate variable `x`, and the Response Variable as a separate variable `y`, because they are going to be graphed along the **x** and **y** axes respectively, in the scatterplot. construct a linear model, and fit the linear model on top of your scatterplot:
```{r}
x= income_no_children$estimate
y= income_with_children$estimate
plot(x, y,
                     xlab= "No Children",
                     ylab="With Children",
                     main= "Median Household of Income in Virginia, by Zip Code")
```

Construct a linear model using the `lm` command, and store it into the variable **reg_line**.

```{r}
reg_line<- lm(income_with_children$estimate ~ income_no_children$estimate)
summary(reg_line)
```

By using `summary`, you get a computer regression printout that helps you evaluate whether the linear regression line is appropriate. The two numbers that you care about are the **standard deviation of the residuals** and the **R-Squared Value**. In R, that is labeled as *Multiple R-Squared*.

```{r}
knitr::include_graphics("resources/images/01-Census-and-Linear-Regression/Regression-Printout.png") 
```

Finally, plot the line of best fit on top of your data, using the `abline` command.

```{r}
plot(x, y,
                     xlab= "No Children",
                     ylab="With Children",
                     main= "Median Household of Income in Virginia, by Zip Code")
abline(reg_line, col="red")
```
## Create a Residual Plot.

You should always evaluate whether a linear regression line is a good fit for the model. One of those tools to evaluate whether the regression is a good fit is to examine the residual plot.

Whenever you create a linear model using the `lm` command, 
```{r}
plot(reg_line$residuals, 
     ylab= "Residual",
     main= "Residual Plot for Linear Model")
```

## Create two data displays.

I want to know if households with children tend to have a higher median income than households with no children. Let's make those two histograms.

```{r}
par(mfrow=c(2, 1))
no_children_histo <- hist(income_no_children$estimate,
                          xlab= "Median Household Income",
                          ylab= "Count (number of Zip Codes)",
                          main= "Median Income of Households with No Children in VA, by Zip Code",
                          col= "sky blue")

no_children_boxplot <- boxplot(income_no_children$estimate,
                               horizontal=TRUE,
                               xlab="Median Household Income",
                               main= "Boxplot with 1.5*IQR Outliers"
                               )
text(x=fivenum(income_no_children$estimate), labels=fivenum(income_no_children$estimate), y=1.3)

par(mfrow=c(2, 1))
with_children_histo <- hist(income_with_children$estimate,
                            xlab= "Median Income",
                            ylab= "Count (number of Zip Codes)",
                            main= "Median Income of Households with Children in VA, by Zip Code",
                            col= "light green")
with_children_boxplot <- boxplot(income_with_children$estimate,
                               horizontal=TRUE,
                               xlab="Median Household Income",
                               main= "Boxplot with 1.5*IQR Outliers"
                               )
text(x=fivenum(income_with_children$estimate), labels=fivenum(income_with_children$estimate), y=1.3)
```

This looks nice, but notice the y-scales are not the same. To make them more comparable, stack the histograms on top of each other using the plot() function. 

```{r}
plot(no_children_histo, 
     col= alpha("sky blue", 1),
     xlim= c(0, 300000),
     xlab= "Median Income",
     main= "Median Household Income in VA, by Zip Code")

plot(with_children_histo,
     col= alpha("light green", 0.5),
     xlim=c(0,300000),
     add= TRUE)

legend(200000, 150, c("No Children", "With Children"), fill= c("sky blue", "light green"), title= "Zoomer Status")
```



### How to remove NA's

**NA's** show up when either data is not available, or the sample size is so small that the data can be personally identifiable. The Census suppresses such data.

Whether you completely remove the NA's is up to you, and dependent on context. When you create any data visualization, R will automatically exclude NA's from this analysis. 

In some contexts, you may want to replace NA's with a specific number like 0. Talk to your teacher about this before you continue. 

```{r}
mean(income_with_children$estimate)

mean(na.omit(income_with_children$estimate))


```


